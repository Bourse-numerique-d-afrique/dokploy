# =============================================================================
# Production Environment Variables - Server 2: Clearing House
# Domain: payments.boursenumeriquedafrique.com
# =============================================================================
# Copy this file to .env.clearing-house and fill in the actual values
# Never commit .env.clearing-house to git!
# =============================================================================

# Version to deploy (use specific versions in production, 'latest' in staging)
VERSION=v0.1.2

# =============================================================================
# Database Configuration (Connects to Server 1)
# =============================================================================
# IMPORTANT: Use Tailscale IP for secure, encrypted database connections
# See TAILSCALE-SETUP.md for configuration instructions

# RECOMMENDED: Tailscale private network (most secure)
# Replace with Server 1's actual Tailscale IP from: tailscale ip -4
POSTGRES_HOST=100.100.100.10

# ALTERNATIVE OPTIONS (if not using Tailscale):

# Option A: VPC Private IP (DigitalOcean, AWS, etc.)
# POSTGRES_HOST=10.x.x.x

# Option B: Public domain with SSL (less secure, requires firewall rules)
# POSTGRES_HOST=api.boursenumeriquedafrique.com

# Option C: Managed database
# POSTGRES_HOST=your-db-cluster.region.db.cloud.com

POSTGRES_PORT=5432
POSTGRES_USER=exchange_user
POSTGRES_PASSWORD=SAME_AS_SERVER_1_PASSWORD
POSTGRES_DATABASE=exchange

# =============================================================================
# Authentication & Security
# =============================================================================
# CRITICAL: These MUST match Server 1 exactly!
TOKEN_ISSUER=boursenumeriquedafrique
JWT_SECRET=SAME_JWT_SECRET_AS_SERVER_1

# NOTE: Admin account auto-creation variables are NOT needed for clearing house.
# The clearing house service handles payment processing only and does not manage
# user accounts. Admin accounts are created on the main exchange server (Server 1).

# =============================================================================
# Ethereum Configuration
# =============================================================================
# IMPORTANT: This should point to Server 1's Ethereum node via Tailscale
# Replace with Server 1's Tailscale IP
ETHEREUM_RPC_URL=http://100.100.100.10:8545

# =============================================================================
# MTN Mobile Money Configuration
# =============================================================================
# Same credentials as Server 1
MTN_URL=https://momodeveloper.mtn.com
MTN_COLLECTION_PRIMARY_KEY=YOUR_MTN_COLLECTION_PRIMARY_KEY
MTN_COLLECTION_SECONDARY_KEY=YOUR_MTN_COLLECTION_SECONDARY_KEY
MTN_DISBURSEMENT_PRIMARY_KEY=YOUR_MTN_DISBURSEMENT_PRIMARY_KEY
MTN_DISBURSEMENT_SECONDARY_KEY=YOUR_MTN_DISBURSEMENT_SECONDARY_KEY

# This server's domain (where MTN sends callbacks)
MTN_WEBHOOK_HOST=payments.boursenumeriquedafrique.com

# =============================================================================
# Airtel Money Configuration
# =============================================================================
# Same credentials as Server 1
AIRTEL_CLIENT_ID=YOUR_AIRTEL_CLIENT_ID
AIRTEL_CLIENT_SECRET=YOUR_AIRTEL_CLIENT_SECRET
AIRTEL_ENVIRONMENT=production
AIRTEL_CALLBACK_URL=https://payments.boursenumeriquedafrique.com/airtel/callback
AIRTEL_DISBURSEMENT_PIN=YOUR_AIRTEL_PIN

# =============================================================================
# Monitoring Configuration
# =============================================================================
PROMETHEUS_ENABLED=false

# =============================================================================
# Network Security Notes
# =============================================================================
# 1. Tailscale Setup (REQUIRED):
#    - Install Tailscale: curl -fsSL https://tailscale.com/install.sh | sh
#    - Connect to network: sudo tailscale up --authkey=YOUR_AUTH_KEY --hostname=clearing-house-prod
#    - Verify connectivity: ping 100.100.100.10 (Server 1)
#    - See TAILSCALE-SETUP.md for complete instructions
#
# 2. Firewall Rules:
#    - Allow inbound: 8500 (main), 5705 (MTN), 5706 (Airtel)
#    - Allow Tailscale: sudo ufw allow in on tailscale0
#    - Database via Tailscale only (no public exposure)
#    - Allow outbound: 443 (payment APIs)
#
# 3. Database Connection:
#    - RECOMMENDED: Use Tailscale IP (encrypted by default)
#    - Block public database access on Server 1: sudo ufw deny 5432
#    - Allow only Tailscale on Server 1: sudo ufw allow in on tailscale0 to any port 5432
#
# 4. Payment Provider Webhooks:
#    - Configure MTN webhook: https://payments.boursenumeriquedafrique.com:5705
#    - Configure Airtel callback: https://payments.boursenumeriquedafrique.com:5706
#    - Use HTTPS with valid SSL certificates
#    - Implement webhook signature verification
